<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Syllabus Query Bot</title>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Lato', sans-serif;
      margin: 2rem;
    }
    textarea {
      font-family: monospace;
      width: 100%;
      max-width: 600px;
    }
    #response {
      white-space: pre-wrap;
      margin-top: 1rem;
      padding: 1rem;
      background: #f4f4f4;
      border: 1px solid #ccc;
      max-width: 600px;
    }
  </style>
</head>
<body>
    <h2>Course Assistant</h2>
    <label for="botMode"><strong>Select a function:</strong></label>
    <br />
    <select id="botMode">
        <option value="syllabus">Syllabus Q&amp;A</option>
        <option value="midterm">Midterm Q&amp;A</option>
        <option value="final">Final Q&amp;A</option>
    </select>
    <hr />

    <form id="queryForm">
        <div id="syllabusInputs">
            <h3>Syllabus Query Page</h3>
            <label for="syllabusQuestion">Ask a question about the syllabus:</label><br />
            <textarea
                    id="syllabusQuestion"
                    rows="5"
                    placeholder="Type your syllabus question here..."
            ></textarea>
        </div>
        <div id="midtermInputs" style="display: none;">
            <h3>Midterm Query Page</h3>
            <label for="midtermQuestion">Ask a question about the midterm:</label><br />
            <textarea
                    id="midtermQuestion"
                    rows="5"
                    placeholder="Type your midterm question here..."
            ></textarea>
        </div>
        <div id="finalInputs" style="display: none;">
            <h3>Final Exam Query Page</h3>
            <label for="finalQuestion">Ask a question about the final exam:</label><br />
            <textarea
                    id="finalQuestion"
                    rows="5"
                    placeholder="Type your final exam question here..."
            ></textarea>
        </div>

        <button type="submit">Submit</button>
    </form>
    <h3>Response:</h3>
    <h5> all queries and responses are anonymously recorded by qualitrics for feedback, research and improvement</h5>
    <pre id="response"></pre>
    <script>
    const botMode = document.getElementById("botMode");
    const syllabusInputs = document.getElementById("syllabusInputs");
    const midtermInputs = document.getElementById("midtermInputs");
    const finalInputs = document.getElementById("finalInputs");
    const form = document.getElementById("queryForm");
    const responseBox = document.getElementById("response");

    botMode.addEventListener("change", () => {
        if (botMode.value === "syllabus") {
            syllabusInputs.style.display = "block";
            finalInputs.style.display = "none";
            midtermInputs.style.display = "none";
        } else if (botMode.value === "midterm") {
            syllabusInputs.style.display = "none";
            finalInputs.style.display = "none";
            midtermInputs.style.display = "block";
        } else {
            syllabusInputs.style.display = "none";
            finalInputs.style.display = "block";
            midtermInputs.style.display = "none";
        }

    });

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        responseBox.textContent = "Loading...";

        const mode = document.getElementById("botMode").value;
        let payload = { mode };

        if (mode === "syllabus") {
          payload.question = document.getElementById("syllabusQuestion").value;
        }
        if (mode === "midterm") {
          payload.question = document.getElementById("midtermQuestion").value;
        }
        if (mode === "final") {
          payload.question = document.getElementById("finalQuestion").value;
        }

        try {
        const res = await fetch("https://work-study-syllabus-bot.deno.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const text = await res.text();
        responseBox.textContent = text;
        } catch (err) {
        responseBox.textContent = "Error contacting server.";
        }
    });


    </script>
</body>
</html>
